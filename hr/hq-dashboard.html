<!-- hq-dashboard.html (versi final tanpa anon key - guna API backend sahaja) -->
<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard HR - Mouthgasm Crunchy</title>
  <link rel="stylesheet" href="../css/style.css" />
</head>
<body>
  <div style="max-width: 800px; margin: 2rem auto; padding: 1rem;">
    <h1 class="dashboard-title">HR Dashboard</h1>

    <!-- BORANG TAMBAH PEKERJA ASAS -->
    <div class="card">
      <h2>Tambah Calon Pekerja</h2>
      <form id="formCalon">
        <label>Nama:</label>
        <input type="text" id="nama" required />

        <label>No. Telefon:</label>
        <input type="text" id="telefon" required />

        <label>Jawatan:</label>
        <input type="text" id="jawatan" required />

        <label>Gaji (RM):</label>
        <input type="number" id="gaji" required />

        <label>Tarikh Mula:</label>
        <input type="date" id="tarikh" required />

        <button type="submit" class="btn-primary">Hantar & WhatsApp</button>
      </form>
    </div>

    <!-- SENARAI CALON -->
    <div class="card">
      <h2 style="margin-bottom: 1rem;">Senarai Calon Pekerja</h2>
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr style="text-align: left;">
            <th>Nama</th>
            <th>No. IC</th>
            <th>No. Telefon</th>
            <th>Status</th>
            <th>Tindakan</th>
          </tr>
        </thead>
        <tbody id="calon-list">
          <!-- Data akan dipaparkan di sini -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    document.getElementById('formCalon').addEventListener('submit', async function(e) {
      e.preventDefault()
      const nama = document.getElementById('nama').value
      const telefon = document.getElementById('telefon').value
      const jawatan = document.getElementById('jawatan').value
      const gaji = document.getElementById('gaji').value
      const tarikh = document.getElementById('tarikh').value

      const res = await fetch('/api/daftar-calon.js', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ nama, telefon, jawatan, gaji, tarikh_mula: tarikh })
      })

      const data = await res.json()
      if (!data?.id) return alert('Ralat semasa simpan data')

      const link = `${window.location.origin}/hr/form.html?id=${data.id}`
      const mesej = `Assalamualaikum ${nama}, Tahniah! Anda dipilih untuk jawatan ${jawatan} di Mouthgasm Crunchy. Sila lengkapkan borang ini: ${link}`
      const wasap = `https://wa.me/6${telefon.replace(/^0/, '')}?text=${encodeURIComponent(mesej)}`

      window.open(wasap, '_blank')
      document.getElementById('formCalon').reset()
      fetchCalon()
    })

    async function fetchCalon() {
      const res = await fetch('/api/get-calon.js')
      const data = await res.json()

      const tbody = document.getElementById('calon-list')
      tbody.innerHTML = ''

      data.forEach((calon) => {
        const row = document.createElement('tr')
        row.innerHTML = `
          <td>${calon.nama}</td>
          <td>${calon.ic || '-'}</td>
          <td>${calon.telefon}</td>
          <td>${calon.status}</td>
          <td>
            ${calon.status === 'belum_disemak'
              ? `<button onclick="terimaCalon('${calon.id}')" class="btn-primary">Terima</button>`
              : `<a href='surat.html?id=${calon.id}' class='btn-primary' target='_blank'>Lihat Surat</a>`}
          </td>
        `
        tbody.appendChild(row)
      })
    }

    async function terimaCalon(id) {
      await fetch('/api/update-calon.js', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id })
      })

      setTimeout(() => {
        window.open(`surat.html?id=${id}`, '_blank')
        fetchCalon()
      }, 500)
    }

    fetchCalon()
  </script>
</body>
</html>
